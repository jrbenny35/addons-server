machine:
  services:
    - docker
  hosts:
    olympia.dev: 127.0.0.1
  node:
    version: 6.9.1
  environment:
    DISPLAY: :99
    PATH: "/home/ubuntu/testpilot/firefox:$PATH"
  post:
    - pyenv global 2.7.12 3.6.1

dependencies:
  override:
    - docker version
    - >
        printf '{"commit":"%s","version":"%s","source":"https://github.com/%s/%s","build":"%s"}\n'
        "$CIRCLE_SHA1"
        "$CIRCLE_TAG"
        "$CIRCLE_PROJECT_USERNAME"
        "$CIRCLE_PROJECT_REPONAME"
        "$CIRCLE_BUILD_URL"
        > version.json
    - echo "Docker Deploy here"

test:
  pre:
    - git clone https://github.com/mozilla/addons-frontend.git
    - |
      curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
      echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
    - sudo apt-get update && sudo apt-get install yarn
    - ./tests/ui/circleci/install-test-depenencies.sh
    - pip install tox
    - mkdir test-results
  override:
    - tox -e ui-tests-1 -- --html=test-results/ui-test.html
  post:
    - cp -r test-results $CIRCLE_ARTIFACTS
